# Ralph Progress Log
Started: 2026-01-17

## Codebase Patterns
- Utils go in `app/utils/` as pure TypeScript functions
- Unit tests follow pattern `tests/unit/utils/<name>.test.ts`
- Tests use vitest with `describe`, `expect`, `it` imports
- Non-null assertions (`!`) used for array index access in strict mode

---

## US-001: Cosine Similarity Function (COMPLETED)

**Date:** 2026-01-17

**Files created:**
- `app/utils/cosineSimilarity.ts` - Pure function for computing cosine similarity between vectors
- `tests/unit/utils/cosineSimilarity.test.ts` - 11 unit tests covering all acceptance criteria

**Implementation notes:**
- Function handles 384-dimension vectors efficiently (under 10ms)
- Returns 0 for zero vectors instead of NaN
- Throws descriptive error for vector length mismatch
- All tests pass, typecheck passes

**Next steps:**
- US-002 depends on this for computing embeddings similarity
- US-003 will use this function in the semantic search composable

---

## US-002: Embedding Generation Script (COMPLETED)

**Date:** 2026-01-17

**Files created:**
- `scripts/generate-embeddings.ts` - Build script using Transformers.js to generate embeddings
- `public/embeddings.json` - Generated embeddings file (248 entries)

**Package changes:**
- Added `@huggingface/transformers` dependency
- Added `generate:embeddings` script to package.json

**Implementation notes:**
- Uses `Xenova/bge-small-en-v1.5` model for 384-dimension embeddings
- Processes title + summary + first 512 chars of body
- Excludes same directories as OG image script (authors, pages, podcasts, etc.)
- Strips markdown syntax from body text before embedding
- Output format: `{ version, model, embeddings: { [slug]: { vector, title, type } } }`
- Script processes ~250 files in reasonable time
- All tests pass, typecheck passes

**Next steps:**
- US-003 (semantic search composable) will load embeddings.json and use cosine similarity
- US-004 (hybrid search) will combine keyword and semantic scores
- US-007 will add this to prebuild script

---

## US-003: Semantic Search Composable (COMPLETED)

**Date:** 2026-01-17

**Files created:**
- `app/composables/useSemanticSearch.ts` - Composable for semantic search against pre-computed embeddings

**Implementation notes:**
- Lazy-loads Transformers.js only when search is first performed
- Fetches and caches embeddings.json on first search
- Converts search query to embedding using bge-small-en-v1.5 model
- Computes cosine similarity against all pre-computed embeddings
- Returns top N results (default 20) sorted by similarity score
- Caches model instance at module level after first load
- Exposes `isLoading` ref for model initialization state
- Exposes `error` ref for failure handling
- Uses Promise-based caching to prevent duplicate model loading
- All tests pass, typecheck passes

**Next steps:**
- US-004 (hybrid search) will combine keyword and semantic scores
- US-005 will integrate this into the search page
- US-006 will integrate this into the command palette

---

