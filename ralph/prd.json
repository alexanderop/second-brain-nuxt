{
  "project": "SecondBrain",
  "branchName": "ralph/semantic-search-transformers-js",
  "description": "Semantic Search with Transformers.js - Enable meaning-based content discovery using pre-computed embeddings and hybrid scoring",
  "userStories": [
    {
      "id": "US-001",
      "title": "Implement cosine similarity function",
      "description": "As a developer, I need an efficient cosine similarity function to compare embedding vectors.",
      "acceptanceCriteria": [
        "Create pure TypeScript function at app/utils/cosineSimilarity.ts",
        "Function accepts two number[] vectors and returns similarity score between -1 and 1",
        "Handles 384-dimension vectors efficiently",
        "No external dependencies",
        "Unit tests for: identical vectors (returns 1), orthogonal vectors (returns 0), zero vectors (handles gracefully)",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Foundation utility - no dependencies on other stories. Simple pure function."
    },
    {
      "id": "US-002",
      "title": "Create embedding generation script",
      "description": "As a developer, I need a script to generate embeddings for all content at build time.",
      "acceptanceCriteria": [
        "Script at scripts/generate-embeddings.ts using @huggingface/transformers",
        "Uses Xenova/bge-small-en-v1.5 model",
        "Processes all markdown files in content/ directory",
        "Generates embeddings from title + summary + first 512 chars of body",
        "Outputs JSON structure: { version: string, model: string, embeddings: { [slug]: { vector: number[], title: string, type: string } } }",
        "Outputs to public/embeddings.json",
        "Add generate:embeddings script to package.json",
        "Script runs successfully via pnpm generate:embeddings",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Run pnpm add @huggingface/transformers first. Script runs in Node with Transformers.js."
    },
    {
      "id": "US-003",
      "title": "Create semantic search composable",
      "description": "As a developer, I need a composable to perform semantic search queries against pre-computed embeddings.",
      "acceptanceCriteria": [
        "Composable at app/composables/useSemanticSearch.ts",
        "Lazy-loads Transformers.js only when search is first performed",
        "Fetches and caches embeddings.json on first search",
        "Converts search query to embedding using bge-small-en-v1.5",
        "Computes cosine similarity against all pre-computed embeddings",
        "Returns top N results (default 20) sorted by similarity score",
        "Caches model instance after first load",
        "Exposes loading state ref for model initialization",
        "Exposes error state ref for failures",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Depends on US-001 (cosine similarity), US-002 (embeddings.json must exist). Core search logic."
    },
    {
      "id": "US-004",
      "title": "Create hybrid search scoring",
      "description": "As a developer, I need a function to combine keyword and semantic search scores.",
      "acceptanceCriteria": [
        "Create hybrid scoring function in app/utils/hybridSearch.ts",
        "Hybrid score formula: (keyword_score * 0.4) + (semantic_score * 0.6)",
        "Weights defined as named constants at top of file",
        "Function merges keyword results and semantic results by slug",
        "Results sorted by hybrid score descending",
        "Keyword-only results included with semantic_score = 0",
        "Semantic-only results included with keyword_score = 0",
        "Returns deduplicated array sorted by hybrid score",
        "Unit tests for merge and deduplication logic",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Pure utility function. Can be tested without semantic search running."
    },
    {
      "id": "US-005",
      "title": "Integrate semantic search into search page",
      "description": "As a user, I want the search page to use hybrid semantic+keyword search.",
      "acceptanceCriteria": [
        "Search page (app/pages/search.vue) uses useSemanticSearch composable",
        "Shows 'Loading semantic search...' indicator while model initializes on first search",
        "Uses hybrid scoring to merge Fuse.js results with semantic results",
        "Falls back to keyword-only search if embeddings.json fails to load",
        "Falls back to keyword-only search if Transformers.js fails to load",
        "Existing keyboard navigation (j/k/enter) continues to work",
        "Typecheck passes",
        "Verify in browser"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Depends on US-003 (composable), US-004 (hybrid scoring). Main integration point."
    },
    {
      "id": "US-006",
      "title": "Integrate semantic search into command palette",
      "description": "As a user, I want the Cmd+K search modal to also use semantic search.",
      "acceptanceCriteria": [
        "Command palette (app/components/AppSearchModal.vue) uses useSemanticSearch composable",
        "Model loaded lazily on first search query typed",
        "Results merged with existing Fuse.js results using hybrid scoring",
        "Loading indicator shown subtly during model initialization",
        "No visual regression to command palette UI",
        "Graceful fallback to keyword-only if semantic search fails",
        "Typecheck passes",
        "Verify in browser"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Depends on US-003 (composable), US-004 (hybrid scoring). Uses same composable as search page."
    },
    {
      "id": "US-007",
      "title": "Add embeddings generation to build pipeline",
      "description": "As a developer, I need embeddings regenerated when content changes.",
      "acceptanceCriteria": [
        "Add prebuild script to package.json that runs generate:embeddings before build",
        "Document pnpm generate:embeddings command in CLAUDE.md",
        "Generate initial embeddings.json file and commit to repo",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": "Final integration story. Ensures embeddings stay up-to-date with content."
    }
  ]
}
