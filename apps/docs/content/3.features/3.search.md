# Search

Second Brain provides powerful full-text search capabilities with two interfaces: a quick command palette (⌘K) and a dedicated search page.

## Quick Search (Command Palette)

Press `⌘K` (or `Cmd+K` on Mac, `Ctrl+K` on Windows/Linux) or `/` from anywhere in the app to open the command palette - a modal search interface for quick navigation.

### Search Categories

The command palette searches across four categories:

| Category | What's Searched | Icon |
|----------|-----------------|------|
| **Notes** | All content pages (title, body text) | File icon |
| **Authors** | Author names | Avatar or user icon |
| **Newsletters** | Newsletter names | Logo or newspaper icon |
| **Podcasts** | Podcast show names | Artwork or podcast icon |

### Using the Command Palette

1. Press `⌘K` or `/` to open
2. Start typing your search query
3. Results appear instantly, grouped by category
4. Use arrow keys or click to select a result
5. Press `Enter` to navigate to the selected item
6. Press `Esc` to close without selecting

The modal automatically closes when you navigate to a result.

## Dedicated Search Page

Navigate to `/search` for a full-page search experience with more detailed results and keyboard navigation.

### Features

- **Debounced Input**: Search waits 300ms after you stop typing to reduce unnecessary queries
- **Match Highlighting**: Search terms are highlighted in results with a colored background
- **Contextual Snippets**: Results show text around the match with `...` ellipsis for context
- **Result Counts**: Shows total number of matches found
- **Recent Content**: When not searching, displays 10 most recent content items

### Keyboard Navigation

The search page supports vim-style navigation:

| Key | Action |
|-----|--------|
| `J` | Move selection down |
| `K` | Move selection up |
| `Enter` | Open selected result |

## Fuzzy Search with Fuse.js

Both search interfaces use [Fuse.js](https://fusejs.io/) for fuzzy matching, meaning:

- **Typo Tolerance**: Find "javascript" even if you type "javasript"
- **Partial Matches**: "react" matches "React Hooks Tutorial"
- **Weighted Results**: Titles are weighted higher than body content

### Search Configuration

The fuzzy search is configured with these parameters:

```typescript
{
  keys: [
    { name: 'title', weight: 1 },      // Highest priority
    { name: 'content', weight: 0.7 },  // Body text
    { name: 'titles', weight: 0.8 },   // Breadcrumb titles
    { name: 'name', weight: 1 },       // Author/podcast names
  ],
  threshold: 0.3,        // Lower = stricter matching
  ignoreLocation: true,  // Match anywhere in text
  minMatchCharLength: 2, // Minimum characters to match
}
```

## Search History

Search history is stored locally in your browser using `localStorage`:

- **Automatic Saving**: Searches are saved as you type
- **Max 10 Items**: History keeps the 10 most recent unique searches
- **Deduplication**: Repeat searches move to the front without duplicates
- **Clearable**: Can be cleared via the preferences composable

### Using Search History

Search history is managed by the `usePreferences()` composable:

```typescript
const { searchHistory, addSearchHistory, clearSearchHistory } = usePreferences()

// Add a search term
addSearchHistory('vue composables')

// Access history
console.log(searchHistory.value) // ['vue composables', 'nuxt', ...]

// Clear all history
clearSearchHistory()
```

## Search Data Sources

Search indexes different content types differently:

### Content Search

Uses `queryCollectionSearchSections()` from @nuxt/content v3 to index:

- Page titles
- Section headings (H1-H6)
- Body text content
- Breadcrumb hierarchy

### Collection Search

Separately queries and indexes:

- **Authors**: name, slug, avatar
- **Podcasts**: name, slug, artwork
- **Newsletters**: name, slug, logo

## Implementation Details

### Command Palette Component

Located at `app/components/AppSearchModal.vue`:

- Uses Nuxt UI's `UCommandPalette` component
- Fetches all searchable data on mount
- Groups results by category (Notes, Authors, Newsletters, Podcasts)
- Custom slots for avatar display per category

### Search Page

Located at `app/pages/search.vue`:

- Full Fuse.js instance for combined content + author search
- Debounced input with `watchDebounced` from VueUse
- Custom snippet extraction with match highlighting
- Keyboard shortcuts via `defineShortcuts`

### Performance Considerations

- **Client-Side Search**: All searching happens in the browser after initial data load
- **One-Time Fetch**: Search data is fetched once via `useAsyncData` and cached
- **Debounced Queries**: 300ms debounce prevents excessive re-renders
- **Result Limiting**: Command palette limits to 15 results per query

## Customization

### Shortcut Configuration

Search shortcuts are defined in `site.config.ts`:

```typescript
shortcuts: {
  general: [
    { keys: ['meta', 'K'], description: 'Open search' },
    { keys: ['/'], description: 'Open search' },
  ],
}
```

### Result Limit

Modify the result limit in `AppSearchModal.vue`:

```typescript
const fuseOptions = {
  fuseOptions: { ... },
  resultLimit: 15, // Change this value
}
```

## Troubleshooting

### No Results Found

1. **Check spelling**: Try alternative spellings or partial words
2. **Lower threshold**: If modifying code, lower the Fuse threshold (e.g., 0.4)
3. **Check content**: Ensure the content exists and isn't in a draft state

### Slow Search

1. **Large dataset**: Search is client-side, so very large knowledge bases may be slower
2. **Browser cache**: Clear browser cache to refresh search index
3. **Memory**: Close unused tabs to free browser memory

### Search Not Opening

1. **Keyboard conflict**: Another app may be capturing `⌘K`
2. **Focus state**: Click in the app window first
3. **Try `/`**: The forward slash shortcut is an alternative
