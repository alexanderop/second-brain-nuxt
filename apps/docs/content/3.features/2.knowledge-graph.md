# Knowledge Graph

The Knowledge Graph is an interactive visualization that reveals the connections between your notes, powered by D3.js force-directed simulation.

## Overview

The graph shows every note in your knowledge base as a node, with edges representing wiki-link connections. This visualization helps you:

- **Discover unexpected connections** between topics
- **Identify knowledge clusters** that naturally form around MOCs
- **Find orphan notes** that need better integration
- **Navigate your knowledge** visually rather than linearly

## Full Graph View

Access the full graph at `/graph`. This immersive view provides:

### Visual Elements

- **Nodes**: Each node represents a content item, sized by connection count
- **Edges**: Lines connecting nodes indicate wiki-link relationships
- **Colors**: Each content type has a distinct color for quick identification
- **Hexagons**: MOC (Map of Content) nodes render as hexagons to stand out

### Graph Modes

The graph operates in two modes:

1. **Freeform Mode** (full graph): Nodes arrange freely via force simulation, clustering naturally around well-connected hubs
2. **Radial Mode** (note graph): Center-focused layout showing a single note and its connections

### Node Sizing

In freeform mode, nodes are sized by connection count using a power scale:
- More connections = larger node
- Range: 8px (isolated) to 40px (highly connected)

### Label Visibility

Labels use "progressive" visibility based on zoom level:
- Zoomed out (`< 0.5x`): Only show labels for nodes with 5+ connections
- Medium zoom (`< 1.0x`): Show labels for nodes with 2+ connections
- Zoomed in (`>= 1.0x`): Show all labels

## Filtering Options

The graph supports powerful filtering to focus on what matters:

### By Content Type

Toggle visibility of any content type. Available types:
- Books, Manga, Podcasts, Articles
- Notes, YouTube, Courses, Quotes
- Movies, TV Shows, Tweets, Evergreen
- Maps, Reddit, GitHub, Newsletters

### By Tags

Select one or more tags to show only nodes containing those tags.

### By Authors

Filter to show content from specific authors.

### By Maps (MOCs)

Focus on a specific Map of Content and its members. When you select a map:
- The map node itself is shown
- All nodes that belong to that map (linked from the MOC) are shown

### Orphan Nodes

Toggle to show/hide orphan nodes (nodes with no connections).

### Filter URL Sync

All filter settings sync to URL query parameters:
- `?types=book,article` - Show only books and articles
- `?tags=programming,vue` - Filter by tags
- `?authors=alexander-opalic` - Filter by author
- `?maps=software-architecture` - Focus on a MOC
- `?orphans=false` - Hide orphan nodes

This enables sharing specific views and bookmarking filtered states.

## Node Interactions

### Hover

- Node enlarges slightly (15% scale)
- Connected edges highlight
- Non-connected nodes dim
- Label becomes visible

### Click

- Opens a detail panel showing:
  - Title and type icon
  - Summary (if available)
  - Authors
  - Tags
  - Map membership
  - Outgoing links (what this note links to)
  - Backlinks (what links to this note)
- Node gets a selection ring
- "View Page" button navigates to the content

### Drag

- Drag any node to reposition it
- Simulation temporarily activates during drag
- Node position persists during session

### Double-Click

- Fits all nodes into view with animation

## Zoom Controls

Located in the bottom-left corner:

| Control | Action |
|---------|--------|
| Maximize icon | Fit all nodes into view |
| `-` | Zoom out (0.7x) |
| Percentage | Current zoom level (click to reset) |
| `+` | Zoom in (1.3x) |

### Zoom Persistence

Zoom level and pan position persist in `sessionStorage`:
- Key: `graph-zoom-transform`
- Restores on page revisit within same session

### Zoom Limits

- Minimum: 10% (see entire graph)
- Maximum: 400% (focus on details)

## Navigation Shortcuts

The graph supports middle mouse button for panning:
- Hold middle mouse button and drag to pan
- Works alongside scroll-to-zoom

## Note Graph (Mini Graph)

Individual content pages show a smaller "Note Graph" at the bottom, displaying:

### Structure

- **Center node**: The current note (larger, with white border)
- **Level 1**: Direct connections (backlinks + outgoing links)
- **Level 2**: Second-degree connections (limited to 20 nodes)

### Visual Differences from Full Graph

- Radial layout (center-focused)
- Smaller node sizes (center: 18px, L1: 10px, L2: 7px)
- Labels only visible for center node
- Reduced opacity for L2 nodes and edges
- Fixed height container (300px)

### Interaction

- Click any non-center node to navigate to that page
- No drag support in radial mode
- Zoom range limited to 0.5x - 2x

## API Endpoints

### `/api/graph`

Returns the full graph data for all content:

```typescript
interface GraphData {
  nodes: {
    id: string           // Slug
    title: string
    type: ContentType
    tags: string[]
    authors: string[]
    summary?: string
    connections: number  // Total edge count
    maps: string[]       // MOC membership
    isMap: boolean
  }[]
  edges: {
    source: string       // Source node ID
    target: string       // Target node ID
  }[]
}
```

### `/api/note-graph/[slug]`

Returns graph data centered on a specific note:

```typescript
interface NoteGraphData {
  center: {
    id: string
    title: string
    type: string
    isCenter: true
    level: 0
  }
  connected: {
    id: string
    title: string
    type: string
    level: 1 | 2        // Distance from center
  }[]
  edges: {
    source: string
    target: string
    level: 1 | 2        // Edge level for styling
  }[]
}
```

## Technical Implementation

### Components

| Component | Purpose |
|-----------|---------|
| `BaseGraph.vue` | Core D3.js visualization engine |
| `KnowledgeGraph.vue` | Full graph page wrapper |
| `NoteGraph.vue` | Mini graph for content pages |
| `GraphFilters.vue` | Filter UI controls |
| `GraphNodePanel.vue` | Selected node detail panel |

### Composables

| Composable | Purpose |
|------------|---------|
| `useGraphFilters()` | URL-synced filter state management |

### Utilities

| Utility | Purpose |
|---------|---------|
| `graphColors.ts` | Type-specific color palette |
| `graphForces.ts` | D3 force simulation configuration |
| `graphNormalize.ts` | Data normalization for both graph modes |

### D3.js Features Used

- `d3-selection` - DOM manipulation
- `d3-zoom` - Pan and zoom behavior
- `d3-drag` - Node dragging
- `d3-scale` - Node sizing calculations
- `d3-array` - Data extent calculations
- Force simulation with:
  - `forceLink` - Edge spring forces
  - `forceManyBody` - Node repulsion
  - `forceCollide` - Prevent overlap
  - `forceCenter` - Gravity toward center
  - Custom clustering force (pulls nodes toward their MOC)

### Breathing Animation

The full graph has a subtle "breathing" animation:
- Simulation periodically restarts with low alpha (0.02)
- Interval: 3 seconds
- Pauses during drag or hover
- Creates gentle, organic movement

### Glow Effects

Each content type has an SVG filter for glow:
- Filter ID: `glow-{type}` (e.g., `glow-book`)
- Gaussian blur with 3px standard deviation
- Color matches node fill

## Responsive Design

### Desktop

- Full-canvas graph
- Collapsible filter panel (top-right)
- Sliding detail panel (right side)
- Glassmorphism UI overlays

### Mobile (`< 768px`)

- Filter panel becomes a bottom drawer
- Node details open in centered modal
- Touch-friendly interactions
