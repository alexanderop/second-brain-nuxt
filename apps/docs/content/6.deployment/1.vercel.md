# Vercel Deployment

Deploy your Second Brain to [Vercel](https://vercel.com) for free hosting with automatic deployments.

## Prerequisites

Before deploying, ensure you have:

1. A GitHub account with your forked repository
2. A [Vercel account](https://vercel.com/signup) (free tier works fine)
3. Your local build working (`pnpm build` completes successfully)

## Step-by-Step Deployment

### 1. Connect Your Repository

1. Log in to [Vercel Dashboard](https://vercel.com/dashboard)
2. Click **"Add New..."** → **"Project"**
3. Import your GitHub repository (you may need to grant Vercel access)
4. Select your Second Brain fork

### 2. Configure Build Settings

Vercel auto-detects Nuxt, but for the monorepo structure you need to configure:

| Setting | Value |
|---------|-------|
| **Framework Preset** | Nuxt.js |
| **Root Directory** | `apps/web` |
| **Build Command** | `pnpm build` |
| **Output Directory** | `.output` |
| **Install Command** | `pnpm install` |

::alert{type="info"}
The Root Directory setting is critical for monorepos. Setting it to `apps/web` ensures Vercel runs commands from the correct location.
::

### 3. Set Node.js Version

Second Brain requires Node.js 24.x for native SQLite support:

1. Go to **Settings** → **General** → **Node.js Version**
2. Select **24.x** from the dropdown
3. Save changes

Alternatively, create a `.nvmrc` file in `apps/web/`:

```
24
```

### 4. Deploy

1. Click **"Deploy"**
2. Wait for the build to complete (typically 2-3 minutes)
3. Your site is live at `https://your-project.vercel.app`

## Environment Variables

Second Brain has no required environment variables for basic functionality. All configuration is done through `site.config.ts`.

### Optional Variables

If you extend the app with external services, add environment variables:

1. Go to **Settings** → **Environment Variables**
2. Add variables for all environments (Production, Preview, Development)

| Variable | Purpose |
|----------|---------|
| `NUXT_PUBLIC_*` | Client-side variables (exposed to browser) |
| `NUXT_*` | Server-side only variables |

::alert{type="warning"}
Never commit secrets to `site.config.ts`. Use environment variables for API keys, database URLs, and other sensitive data.
::

## Custom Domain Setup

### Add Your Domain

1. Go to **Settings** → **Domains**
2. Enter your domain (e.g., `brain.yourdomain.com`)
3. Click **"Add"**

### Configure DNS

Vercel provides two options:

**Option A: CNAME (recommended for subdomains)**
```
brain.yourdomain.com  CNAME  cname.vercel-dns.com
```

**Option B: A Record (for apex domains)**
```
yourdomain.com  A  76.76.21.21
```

### Enable HTTPS

Vercel automatically provisions SSL certificates. No configuration needed.

## Monorepo Considerations

### Build Caching

Vercel caches dependencies between builds. For the monorepo:

- The pnpm lockfile at root ensures consistent installs
- Changes to `apps/web` trigger rebuilds
- Changes to `apps/docs` do NOT trigger web rebuilds (separate projects)

### Deploy Docs Separately

To deploy the documentation site:

1. Create a second Vercel project
2. Set **Root Directory** to `apps/docs`
3. Deploy to a different domain (e.g., `docs.yourdomain.com`)

See the [CI/CD Guide](/deployment/ci-cd) for automated dual deployments.

## Deployment Configuration

The app is pre-configured for Vercel in `nuxt.config.ts`:

```typescript
// Required for Vercel serverless deployment
content: {
  database: {
    type: 'sqlite',
    filename: ':memory:',
  },
  // Use Node.js built-in SQLite (v22.5.0+) to avoid better-sqlite3 native bindings
  experimental: {
    sqliteConnector: 'native',
  },
},

// Pre-render content pages to avoid cold start delays
routeRules: {
  '/**': { prerender: true },
},

nitro: {
  prerender: {
    crawlLinks: true,
    routes: ['/', '/api/graph', '/api/backlinks'],
    failOnError: false,
  },
},
```

### Key Configuration Points

| Setting | Purpose |
|---------|---------|
| `sqlite: ':memory:'` | Uses in-memory database (Vercel has no persistent filesystem) |
| `sqliteConnector: 'native'` | Uses Node.js built-in SQLite, avoiding native bindings |
| `prerender: true` | Pre-renders all pages at build time for fast loading |
| `crawlLinks: true` | Automatically discovers and pre-renders linked pages |

## Troubleshooting

### Build Fails with SQLite Error

**Symptom**: `better-sqlite3` native module errors

**Solution**: Ensure your `nuxt.config.ts` has:
```typescript
content: {
  experimental: {
    sqliteConnector: 'native',
  },
},
```

This uses Node.js 24's built-in SQLite instead of the native `better-sqlite3` package.

### Build Fails with Node Version Error

**Symptom**: `Unsupported engine` or `engines.node` mismatch

**Solution**:
1. Set Node.js version to 24.x in Vercel settings
2. Or add `.nvmrc` file with `24`

### Pages Return 404

**Symptom**: Content pages work locally but 404 on Vercel

**Solution**: Ensure prerendering is enabled:
```typescript
routeRules: {
  '/**': { prerender: true },
},
```

Then redeploy to regenerate all pages.

### Cold Start Delays

**Symptom**: First request takes 3-5 seconds

**Solution**: The pre-render configuration minimizes this. For further optimization:
1. Keep content within reasonable limits (thousands, not tens of thousands)
2. Use Vercel's Edge Functions for frequently accessed APIs
3. Consider Vercel Pro for longer function execution times

## Automatic Deployments

Vercel automatically deploys:

- **Production**: On push to `main` branch
- **Preview**: On pull requests (unique URL per PR)

### Preview Deployments

Every PR gets a preview URL like `your-project-git-feature-branch.vercel.app`. Use these to:

- Review content changes before merging
- Test new features in production-like environment
- Share work-in-progress with collaborators

## Next Steps

- [Deploy to Other Platforms](/deployment/other-platforms) - Netlify, Cloudflare alternatives
- [Configure CI/CD](/deployment/ci-cd) - GitHub Actions for automated testing
- [Site Configuration](/customization/site-config) - Customize before deploying
